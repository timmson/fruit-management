<?
function getTaskEnd($start, $length) {
	$hourinsec = 60*60;
	$dayinsec = 24*$hourinsec;
	$nightinsec = 15*$hourinsec;
	$lastw = floor($length/40);
	$lastd = floor(($length%40)/8);
	$lasth = $length%8;
	$end = $start + $lastw*7*$dayinsec + $lastd*$dayinsec + $lasth*$hourinsec;
	$nextdayh = date("H", $end);
	if (($nextdayh >= 18)||($nextdayh < 9)) {
		$end += $nightinsec;
	}
	$end += (date("W", $end)-date("W",$start))*2*$dayinsec;
	while(isHoliday(date('d.m.Y', $end))) {
		$end += $dayinsec;	
	}
	return $end;
}

function getMonthCalendar($plandate) {
	$cal = array();
	$month = date("m", $plandate);
	$year = date("Y", $plandate);
	$length = cal_days_in_month(CAL_GREGORIAN, $month, $year);
	for ($i=0; $i<$length; $i++) {
		$cal[$i]['day'] = $i+1;
		$time = strtotime($cal[$i]['day'].".".$month.".".$year);
		$cal[$i]['isweekend'] = isHoliday(date('d.m.Y', $time));
	}
	return $cal;
}

function isHoliday($date) {
	global $HOLIDAY;
	return in_array($date, $HOLIDAY);
}

$HOLIDAY = array(
	'01.01.2013',
	'02.01.2013',
	'03.01.2013',
	'04.01.2013',
	'05.01.2013',
	'06.01.2013',
	'07.01.2013',
	'08.01.2013',
	'12.01.2013',
	'13.01.2013',
	'19.01.2013',
	'20.01.2013',
	'26.01.2013',
	'27.01.2013',
	'02.02.2013',
	'03.02.2013',
	'09.02.2013',
	'10.02.2013',
	'16.02.2013',
	'17.02.2013',
	'23.02.2013',
	'24.02.2013',
	'02.03.2013',
	'03.03.2013',
	'08.03.2013',
	'09.03.2013',
	'10.03.2013',
	'16.03.2013',
	'17.03.2013',
	'23.03.2013',
	'24.03.2013',
	'30.03.2013',
	'31.03.2013',
	'06.04.2013',
	'07.04.2013',
	'13.04.2013',
	'14.04.2013',
	'20.04.2013',
	'21.04.2013',
	'27.04.2013',
	'28.04.2013',
	'01.05.2013',
	'02.05.2013',
	'03.05.2013',
	'04.05.2013',
	'05.05.2013',
	'09.05.2013',
	'10.05.2013',
	'11.05.2013',
	'12.05.2013',
	'18.05.2013',
	'19.05.2013',
	'25.05.2013',
	'26.05.2013',
	'01.06.2013',
	'02.06.2013',
	'08.06.2013',
	'09.06.2013',
	'12.06.2013',
	'15.06.2013',
	'16.06.2013',
	'22.06.2013',
	'23.06.2013',
	'29.06.2013',
	'30.06.2013',
	'06.07.2013',
	'07.07.2013',
	'13.07.2013',
	'14.07.2013',
	'20.07.2013',
	'21.07.2013',
	'27.07.2013',
	'28.07.2013',
	'03.08.2013',
	'04.08.2013',
	'10.08.2013',
	'11.08.2013',
	'17.08.2013',
	'18.08.2013',
	'24.08.2013',
	'25.08.2013',
	'31.08.2013',
	'01.09.2013',
	'07.09.2013',
	'08.09.2013',
	'14.09.2013',
	'15.09.2013',
	'21.09.2013',
	'22.09.2013',
	'28.09.2013',
	'29.09.2013',
	'05.10.2013',
	'06.10.2013',
	'12.10.2013',
	'13.10.2013',
	'19.10.2013',
	'20.10.2013',
	'26.10.2013',
	'27.10.2013',
	'02.11.2013',
	'03.11.2013',
	'04.11.2013',
	'09.11.2013',
	'10.11.2013',
	'16.11.2013',
	'17.11.2013',
	'23.11.2013',
	'24.11.2013',
	'30.11.2013',
	'01.12.2013',
	'07.12.2013',
	'08.12.2013',
	'14.12.2013',
	'15.12.2013',
	'21.12.2013',
	'22.12.2013',
	'28.12.2013',
);
?>
